<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>King Play - Series</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
/* === Estilos globales === */
body {
  margin: 0;
  background-color: #000;
  font-family: sans-serif;
  color: #fff;
  overflow-x: hidden;
}
.carousel-wrapper {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}
.carousel-container {
  width: 90%;
  aspect-ratio: 16 / 9;
  border-radius: 20px;
  overflow: hidden;
  position: relative;
  background: #000;
}
.carousel-image {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 1s ease-in-out;
  z-index: 0;
}
.carousel-image.active {
  opacity: 1;
  z-index: 1;
}
.menu-bar {
  display: flex;
  justify-content: center;
  gap: 16px;
  margin: 20px auto 10px;
}
.menu-bar button {
  padding: 10px 20px;
  background-color: transparent;
  border: 2px solid transparent;
  border-radius: 10px;
  font-size: 1rem;
  color: #00bfff;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 0 10px 2px rgba(0,191,255,0.4);
}
.menu-bar button:hover,
.menu-bar button:focus {
  background-color: rgba(0, 191, 255, 0.1);
  transform: scale(1.05);
  outline: none;
}
.search-bar {
  text-align: center;
  margin: 10px 0 30px;
}
.search-bar input {
  padding: 10px;
  width: 80%;
  max-width: 500px;
  font-size: 1rem;
  border: 2px solid transparent;
  border-radius: 10px;
  background-color: transparent;
  color: #fff;
  outline: none;
  box-shadow: 0 0 10px 2px rgba(0,191,255,0.4);
}
.search-bar input::placeholder {
  color: #aaa;
}
.slider {
  margin-bottom: 40px;
}
.slider h2 {
  font-size: 1.5rem;
  margin-left: 20px;
}
.slider-row {
  display: flex;
  overflow-x: auto;
  scroll-behavior: smooth;
  padding: 0 24px;
  outline: none;
}
.slider-row .card {
  flex: 0 0 auto;
  width: 160px;
  height: 240px;
  background-color: #222;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
  transition: transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
  margin: 20px 12px;
}
.card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.card:focus {
  outline: none;
  transform: scale(1.05);
  box-shadow: 0 0 20px 4px #00bfff;
  z-index: 2;
}
.card-title {
  position: absolute;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  width: 100%;
  text-align: center;
  font-size: 0.9rem;
  padding: 4px;
}
.card.ver-mas {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: rgba(255, 255, 255, 0.1);
  font-size: 1rem;
  color: #fff;
  border: 2px dashed #00bfff;
  margin: 20px auto 40px;
  width: 160px;
  height: 240px;
  cursor: pointer;
}
.card.ver-mas:focus {
  outline: none;
  transform: scale(1.05);
  box-shadow: 0 0 25px 6px #00bfff;
  z-index: 3;
}
/* === Popup === */
.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9;
}
.popup {
  width: 60%;
  aspect-ratio: 16 / 9;
  background-color: rgba(34, 34, 34, 0.85);
  border-radius: 12px;
  box-shadow: 0 0 20px 5px rgba(0, 191, 255, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  text-align: center;
  z-index: 10;
}
.popup h2 { color: #fff; font-size: 1.5rem; }
body {
      margin: 0;
      background-color: #000;
      font-family: sans-serif;
      color: #fff;
      overflow-x: hidden;
    }
    .carousel-wrapper {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .carousel-container {
      width: 90%;
      aspect-ratio: 16 / 9;
      border-radius: 20px;
      overflow: hidden;
      position: relative;
      background: #000;
    }
    .carousel-image {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      z-index: 0;
    }
    .carousel-image.active {
      opacity: 1;
      z-index: 1;
    }
    .menu-bar {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 20px auto 10px;
    }
    .menu-bar button {
      padding: 10px 20px;
      background-color: transparent;
      border: 2px solid transparent;
      border-radius: 10px;
      font-size: 1rem;
      color: #00bfff;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 0 10px 2px rgba(0,191,255,0.4);
    }
    .menu-bar button:hover,
    .menu-bar button:focus {
      background-color: rgba(0, 191, 255, 0.1);
      transform: scale(1.05);
      outline: none;
    }
    .search-bar {
      text-align: center;
      margin: 10px 0 30px;
    }
    .search-bar input {
      padding: 10px;
      width: 80%;
      max-width: 500px;
      font-size: 1rem;
      border: 2px solid transparent;
      border-radius: 10px;
      background-color: transparent;
      color: #fff;
      outline: none;
      box-shadow: 0 0 10px 2px rgba(0,191,255,0.4);
    }
    .search-bar input::placeholder {
      color: #aaa;
    }
    .slider {
      margin-bottom: 40px;
    }
    .slider h2 {
      font-size: 1.5rem;
      margin-left: 20px;
    }
    .slider-row {
      display: flex;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding: 0 24px;
      outline: none;
    }
    .slider-row .card {
      flex: 0 0 auto;
      width: 160px;
      height: 240px;
      background-color: #222;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      margin: 20px 12px;
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .card:focus {
      outline: none;
      transform: scale(1.05);
      box-shadow: 0 0 20px 4px #00bfff;
      z-index: 2;
    }
    .card-title {
      position: absolute;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      width: 100%;
      text-align: center;
      font-size: 0.9rem;
      padding: 4px;
    }
    .card.ver-mas {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.1);
      font-size: 1rem;
      color: #fff;
      border: 2px dashed #00bfff;
      border-radius: 12px;
      margin: 20px auto 40px;
      width: 160px;
      height: 240px;
      cursor: pointer;
      overflow: hidden;
    }
    .card.ver-mas:focus {
      outline: none;
      transform: scale(1.05);
      box-shadow: 0 0 25px 6px #00bfff;
      z-index: 3;
    }
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9;
    }
    .popup {
      width: 60%;
      aspect-ratio: 16 / 9;
      background-color: rgba(34, 34, 34, 0.85);
      border-radius: 12px;
      box-shadow: 0 0 20px 5px rgba(0, 191, 255, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
      text-align: center;
      z-index: 10;
    }
    .popup h2 { color: #fff; font-size: 1.5rem; }
    .popup button {
      background-color: #00bfff;
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      color: white;
      border-radius: 8px;
      margin-top: 20px;
      cursor: pointer;
      outline: none;
    }
    .popup button:hover { background-color: #0099cc; }
</style>
</head>
<body>

<!-- Carrusel -->
<div class="carousel-wrapper">
  <div class="carousel-container" id="carousel-container">
    <img class="carousel-image active" src="https://images2.imgbox.com/87/ce/T0um6IwN_o.jpg" />
    <img class="carousel-image" src="https://images2.imgbox.com/41/0a/d5N9fJDY_o.jpg" />
    <img class="carousel-image" src="https://images2.imgbox.com/51/6e/9xuKLLlO_o.jpg" />
  </div>
</div>

<!-- Menú -->
<div class="menu-bar">
  <button onclick="location.href='index.html'">Películas</button>
  <button onclick="location.href='index_series.html'">Series</button>
  <button onclick="location.href='index_animes.html'">Animes</button>
</div>

<!-- Buscador -->
<div class="search-bar">
  <form id="searchForm" onsubmit="handleSearch(event)">
    <input type="text" id="searchInput" placeholder="Buscar series por título..." />
  </form>
</div>


<!-- Popup de actualización -->
<div class="popup-overlay" id="popupOverlay">
  <div class="popup" id="popup">
    <h2>Hay una nueva versión disponible</h2>
    <button id="updateButton">Actualizar</button>
  </div>
</div>

<!-- Sliders dinámicos -->
<div id="sliders"></div>

<!-- Banner -->
<div id="banner-onclicka" style="text-align:center;margin-top:40px;">
  <script async src="https://js.onclckmn.com/static/onclicka.js" data-admpid="322235"></script>
</div>

<script>
let current = 0;
const images = document.querySelectorAll(".carousel-image");
setInterval(() => {
  images[current].classList.remove("active");
  current = (current + 1) % images.length;
  images[current].classList.add("active");
}, 4000);

function xorDecrypt(input, key) {
  let output = '';
  for (let i = 0; i < input.length; i++) {
    output += String.fromCharCode(input.charCodeAt(i) ^ key.charCodeAt(i % key.length));
  }
  return output;
}
function decodeBase64(input) {
  return atob(input);
}

const JSON_URL = "https://raw.githubusercontent.com/Andymix1986/Advance_pelis/refs/heads/main/contenidos.json";
const storedVersion = localStorage.getItem('version') || '1.0.0';
let newVersionFromJson = storedVersion;

function compareVersions(current, next) {
  const a = current.split('.').map(Number);
  const b = next.split('.').map(Number);
  return b.some((v, i) => v > a[i]);
}

function showPopup(msg) {
  document.querySelector("#popup h2").textContent = msg;
  document.getElementById("popupOverlay").style.display = "flex";
}

fetch(JSON_URL)
  .then(r => r.text())
  .then(data => {
    const json = JSON.parse(xorDecrypt(decodeBase64(data), "andymix1986"));
    newVersionFromJson = json.version;
    if (compareVersions(storedVersion, newVersionFromJson)) showPopup(json.mensaje);

    // Filtrar solo series
    const series = json.contenidos.filter(p => p.tipo === "Serie");

    const container = document.getElementById("sliders");
    container.innerHTML = '';

    // Dividir en 5 sliders de 7 tarjetas c/u
    const slidersCount = 5;
    const cardsPerSlider = 7;

    for (let i = 0; i < slidersCount; i++) {
      const start = i * cardsPerSlider;
      const end = start + cardsPerSlider;
      const slice = series.slice(start, end);
      if (slice.length === 0) break;

      const slider = document.createElement("div");
      slider.className = "slider";
      slider.innerHTML = `<h2>Series</h2>`;

      const row = document.createElement("div");
      row.className = "slider-row";
      row.tabIndex = 0;

      slice.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        card.tabIndex = 0;
        card.setAttribute("data-url", p.url);
        card.setAttribute("data-titulo", p.titulo);

        const img = document.createElement("img");
        img.src = p.imagen;
        img.alt = p.titulo;
        img.loading = "lazy";

        const title = document.createElement("div");
        title.className = "card-title";
        title.textContent = p.titulo;

        card.append(img, title);
        row.appendChild(card);
      });

      slider.appendChild(row);
      container.appendChild(slider);
    }

    // Tarjeta Ver Más centrada debajo del último slider
    const verMas = document.createElement("div");
    verMas.className = "card ver-mas";
    verMas.tabIndex = 0;
    verMas.textContent = "Ver más";
    verMas.onclick = () => {
      location.href = "ver_categoria.html?tipo=serie&origen=series";
    };
    container.appendChild(verMas);

    // Observador para animaciones (opcional)
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.slider').forEach(s => observer.observe(s));

  })
  .catch(console.error);

document.getElementById("updateButton").onclick = () => {
  localStorage.setItem('version', newVersionFromJson);
  location.reload();
};

function handleSearch(event) {
  event.preventDefault();
  const query = document.getElementById("searchInput").value.trim();
  if (query) {
    location.href = `resultados.html?q=${encodeURIComponent(query)}&origen=series`;
  }
}


// Navegación con control remoto - navegación por filas y foco visible
document.addEventListener('keydown', (e) => {
  const KEY_LEFT = 37;
  const KEY_UP = 38;
  const KEY_RIGHT = 39;
  const KEY_DOWN = 40;
  const KEY_ENTER = 13;

  const focusableCards = Array.from(document.querySelectorAll('.slider-row .card, .card.ver-mas'));
  if (focusableCards.length === 0) return;

  const active = document.activeElement;
  if (!active.classList.contains('card') && !active.classList.contains('ver-mas')) {
    // Si no hay foco en tarjetas, poner foco en primera tarjeta
    focusableCards[0].focus();
    e.preventDefault();
    return;
  }

  let index = focusableCards.indexOf(active);
  if (index === -1) return;

  // Obtener estructura: 5 sliders * 7 tarjetas
  // Navegación horizontal mueve dentro del mismo slider
  // Navegación vertical salta al slider arriba/abajo (7 tarjetas por slider)

  const slidersCount = 5;
  const cardsPerSlider = 7;

  switch (e.keyCode) {
    case KEY_LEFT:
      if (index % cardsPerSlider > 0) {
        focusableCards[index - 1].focus();
        e.preventDefault();
      }
      break;
    case KEY_RIGHT:
      if (index % cardsPerSlider < cardsPerSlider - 1 && index < focusableCards.length - 2) {
        // -2 porque el último es "Ver más" que está solo y no cuenta dentro de sliders
        focusableCards[index + 1].focus();
        e.preventDefault();
      }
      break;
    case KEY_UP:
      if (index - cardsPerSlider >= 0) {
        focusableCards[index - cardsPerSlider].focus();
        e.preventDefault();
      }
      break;
    case KEY_DOWN:
      if (index + cardsPerSlider < focusableCards.length - 1) {
        focusableCards[index + cardsPerSlider].focus();
        e.preventDefault();
      } else if (index + cardsPerSlider === focusableCards.length - 1) {
        // Pasar a "Ver más" si está justo debajo
        focusableCards[focusableCards.length - 1].focus();
        e.preventDefault();
      }
      break;
    case KEY_ENTER:
      // Ejecutar click en tarjeta activa
      active.click();
      e.preventDefault();
      break;
  }
});

// Al hacer click en una tarjeta lanzar el player
document.addEventListener("click", e => {
  const card = e.target.closest('.card');
  if (card && !card.classList.contains("ver-mas")) {
    const titulo = card.getAttribute("data-titulo");
    const tipo = "Serie"; // Cambiar a "Anime" en index_animes
    location.href = `advancepelis://playerUniversal?titulo=${encodeURIComponent(titulo)}&tipo=${encodeURIComponent(tipo)}`;
  }
});
</script>

</body>
</html>
