<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>King Play - Ver Categor√≠a</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
  margin: 0;
  background-color: #000;
  font-family: sans-serif;
  color: #fff;
  overflow-x: hidden;
}
#tituloCategoria {
  color: #00bfff;
  font-size: 1.8rem;
  margin: 20px 0 8px;
  text-align: center;
}
#btnVolver {
  display: block;
  margin: 0 auto 30px auto;
  padding: 8px 20px;
  font-size: 1rem;
  border-radius: 8px;
  border: 2px solid #00bfff;
  background: transparent;
  color: #00bfff;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
#btnVolver:hover {
  background-color: rgba(0, 191, 255, 0.2);
}
.slider-row {
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: center;
  outline: none;
  width: 95%;
  max-width: 1100px;
  margin-left: auto;
  margin-right: auto;
}
.card {
  width: 160px;
  height: 240px;
  background-color: #222;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.card:focus {
  outline: none;
  transform: scale(1.05);
  box-shadow: 0 0 20px 4px #00bfff;
  z-index: 2;
}
.card-title {
  position: absolute;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  width: 100%;
  text-align: center;
  font-size: 0.9rem;
  padding: 4px;
}
.no-results {
  color: #aaa;
  text-align: center;
  width: 100%;
  margin-top: 40px;
  font-size: 1.2rem;
}
</style>
</head>
<body>

<h2 id="tituloCategoria"></h2>
<button id="btnVolver">Volver al inicio</button>

<div class="slider-row" id="cardsContainer"></div>

<script>
function xorDecrypt(input, key) {
  let output = '';
  for (let i = 0; i < input.length; i++) {
    output += String.fromCharCode(input.charCodeAt(i) ^ key.charCodeAt(i % key.length));
  }
  return output;
}
function decodeBase64(input) {
  return atob(input);
}

const urlParams = new URLSearchParams(window.location.search);
const categoriaParam = urlParams.get('cat') || '';
const estrenoParam = urlParams.get('estreno') || '';
const tipoParam = urlParams.get('tipo') || '';
const origen = urlParams.get('origen') || 'peliculas';

document.getElementById('tituloCategoria').textContent = estrenoParam === '1' ? 'Estrenos' : categoriaParam || 'Contenido';

document.getElementById('btnVolver').onclick = () => {
  if (origen === 'series') {
    location.href = 'index_series.html';
  } else if (origen === 'animes') {
    location.href = 'index_animes.html';
  } else {
    location.href = 'index.html';
  }
};

fetch("https://raw.githubusercontent.com/Andymix1986/Advance_pelis/refs/heads/main/contenidos.json")
  .then(r => r.text())
  .then(data => {
    const json = JSON.parse(xorDecrypt(decodeBase64(data), "andymix1986"));
    const lista = json.contenidos.filter(item => {
      if (estrenoParam === '1') {
        return item.estreno === "Estreno" && (item.tipo === "Pelicula" || item.tipo === "Serie" || item.tipo === "Anime");
      }
      if (categoriaParam) {
        return (item.categoria || "").toLowerCase() === categoriaParam.toLowerCase() && item.tipo === "Pelicula";
      }
      if (tipoParam) {
        return item.tipo.toLowerCase() === tipoParam.toLowerCase();
      }
      return false;
    });

    const contenedor = document.getElementById('cardsContainer');
    contenedor.innerHTML = '';

    if (lista.length === 0) {
      contenedor.innerHTML = '<p class="no-results">No se encontraron resultados.</p>';
      return;
    }

    lista.forEach(p => {
      const card = document.createElement('div');
      card.className = 'card';
      card.tabIndex = 0;
      card.setAttribute('data-url', p.url);
      card.setAttribute('data-titulo', p.titulo);

      const img = document.createElement('img');
      img.src = p.imagen;
      img.alt = p.titulo;
      img.loading = "lazy";

      const title = document.createElement('div');
      title.className = 'card-title';
      title.textContent = p.titulo;

      card.append(img, title);
      contenedor.appendChild(card);
    });

    document.addEventListener('click', e => {
      const card = e.target.closest('.card');
      if (card) {
        const url = card.getAttribute('data-url');
        const titulo = card.getAttribute('data-titulo');
        location.href = `advancepelis://player?url=${encodeURIComponent(url)}&titulo=${encodeURIComponent(titulo)}`;
      }
    });
  })
  .catch(console.error);
</script>

</body>
</html>
