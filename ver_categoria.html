<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>King Play - Ver Categoría</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
/* Reutiliza estilos de index para consistencia */
body {
  margin: 0;
  background-color: #000;
  font-family: sans-serif;
  color: #fff;
  overflow-x: hidden;
}
.menu-bar {
  display: flex;
  justify-content: center;
  gap: 16px;
  margin: 20px auto 10px;
}
.menu-bar button {
  padding: 10px 20px;
  background-color: transparent;
  border: 2px solid transparent;
  border-radius: 10px;
  font-size: 1rem;
  color: #00bfff;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 0 10px 2px rgba(0,191,255,0.4);
}
.menu-bar button:hover {
  background-color: rgba(0, 191, 255, 0.1);
  transform: scale(1.05);
}
.slider {
  margin: 20px auto;
  max-width: 960px;
}
.slider h2 {
  font-size: 2rem;
  margin-bottom: 20px;
  text-align: center;
}
.slider-row {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
}
.slider-row .card {
  flex: 0 0 auto;
  width: 160px;
  height: 240px;
  background-color: #222;
  border-radius: 12px;
  overflow: hidden;
  position: relative;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.slider-row .card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.slider-row .card:focus {
  outline: none;
  transform: scale(1.05);
  box-shadow: 0 0 20px 4px #00bfff;
  z-index: 2;
}
.slider-row .card-title {
  position: absolute;
  bottom: 0;
  background: rgba(0,0,0,0.7);
  width: 100%;
  text-align: center;
  font-size: 0.9rem;
  padding: 4px;
}
.no-results {
  text-align: center;
  font-size: 1.5rem;
  margin: 40px 20px;
  color: #999;
}
</style>
</head>
<body>

<!-- Menú -->
<div class="menu-bar">
  <button id="btnVolver">Volver al inicio</button>
</div>

<!-- Contenedor de tarjetas -->
<div class="slider" id="slider">
  <h2 id="tituloCategoria"></h2>
  <div class="slider-row" id="cardsContainer"></div>
</div>

<script>
function getParam(param) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(param);
}

const cat = getParam("cat");
const esEstreno = getParam("estreno") === "1";

const indexOrigen = (function() {
  // Detectar si venimos de index_series o index_animes para botón "volver"
  if (document.referrer.includes("index_series.html")) return "index_series.html";
  if (document.referrer.includes("index_animes.html")) return "index_animes.html";
  return "index.html";
})();

document.getElementById("btnVolver").onclick = () => {
  location.href = indexOrigen;
};

fetch("https://raw.githubusercontent.com/Andymix1986/Advance_pelis/refs/heads/main/contenidos.json")
  .then(r => r.text())
  .then(data => {
    // Usar la misma función de desencriptación que en index
    function xorDecrypt(input, key) {
      let output = '';
      for (let i = 0; i < input.length; i++) {
        output += String.fromCharCode(input.charCodeAt(i) ^ key.charCodeAt(i % key.length));
      }
      return output;
    }
    function decodeBase64(input) {
      return atob(input);
    }

    const json = JSON.parse(xorDecrypt(decodeBase64(data), "andymix1986"));

    let filtrados = [];

    if (esEstreno) {
      filtrados = json.contenidos.filter(p => p.estreno === "Estreno" && p.tipo === "Pelicula");
      document.getElementById("tituloCategoria").textContent = "Estrenos";
    } else if (cat) {
      filtrados = json.contenidos.filter(p => {
        if (!p.categoria) return false;
        return p.categoria.toLowerCase() === cat.toLowerCase() && p.tipo === "Pelicula";
      });
      document.getElementById("tituloCategoria").textContent = cat;
    } else {
      document.getElementById("tituloCategoria").textContent = "Sin resultados";
    }

    const contenedor = document.getElementById("cardsContainer");
    contenedor.innerHTML = "";

    if (filtrados.length === 0) {
      contenedor.innerHTML = `<div class="no-results">No se encontraron resultados.</div>`;
      return;
    }

    filtrados.forEach(p => {
      const card = document.createElement("div");
      card.className = "card";
      card.tabIndex = 0;
      card.setAttribute("data-url", p.url);
      card.setAttribute("data-titulo", p.titulo);

      const img = document.createElement("img");
      img.src = p.imagen;
      img.alt = p.titulo;
      img.loading = "lazy";

      const title = document.createElement("div");
      title.className = "card-title";
      title.textContent = p.titulo;

      card.append(img, title);
      contenedor.appendChild(card);
    });

    document.addEventListener("click", e => {
      const card = e.target.closest('.card');
      if (card) {
        const url = card.getAttribute("data-url");
        const titulo = card.getAttribute("data-titulo");
        location.href = `advancepelis://player?url=${encodeURIComponent(url)}&titulo=${encodeURIComponent(titulo)}`;
      }
    });
  })
  .catch(console.error);
</script>

</body>
</html>
